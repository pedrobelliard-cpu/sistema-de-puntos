
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gesti√≥n - Innovaci√≥n</title>
    <style>
        /* --- ESTILOS VISUALES (INTACTOS) --- */
        :root {
            --primary: #2563eb;       
            --secondary: #1e293b;     
            --accent: #10b981;        
            --bg: #f1f5f9;            
            --card: #ffffff;          
            --danger: #ef4444;
            --edit: #f59e0b; /* Color para el bot√≥n editar */
        }

        body { font-family: 'Segoe UI', system-ui, sans-serif; background-color: var(--bg); color: var(--secondary); margin: 0; padding: 20px; }
        .container { max-width: 1280px; margin: 0 auto; }

        /* HEADER */
        .header { display: flex; justify-content: space-between; align-items: center; background: var(--card); padding: 20px 30px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); margin-bottom: 30px; border-left: 5px solid var(--primary); }
        .header h1 { margin: 0; font-size: 22px; color: var(--secondary); text-transform: uppercase; letter-spacing: 0.5px; }
        .header p { margin: 5px 0 0; color: #64748b; font-size: 14px; font-weight: 500; }
        
        .actions { display: flex; gap: 10px; }

        .btn-main { background: var(--primary); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 8px; }
        .btn-main:hover { background: #1d4ed8; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2); }

        .btn-print { background: var(--secondary); color: white; border: none; padding: 12px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .btn-print:hover { background: #334155; }

        /* KPI CARDS */
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: var(--card); padding: 25px; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .kpi-title { font-size: 13px; text-transform: uppercase; letter-spacing: 1px; color: #64748b; font-weight: 700; }
        .kpi-number { font-size: 36px; font-weight: 800; margin-top: 10px; color: var(--secondary); }
        
        /* GR√ÅFICAS */
        .charts-section { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 25px; margin-bottom: 30px; }
        .chart-box { background: var(--card); padding: 25px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .chart-header { font-weight: bold; margin-bottom: 20px; font-size: 18px; border-bottom: 2px solid #f1f5f9; padding-bottom: 10px; }
        
        .bar-container { display: flex; align-items: center; margin-bottom: 15px; font-size: 14px; }
        .bar-name { width: 140px; text-align: right; padding-right: 15px; font-weight: 500; color: #475569; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .bar-bg { flex: 1; background: #f1f5f9; height: 28px; border-radius: 6px; overflow: hidden; position: relative; }
        .bar-fill { height: 100%; display: flex; align-items: center; justify-content: flex-end; padding-right: 10px; color: white; font-weight: bold; font-size: 12px; transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1); }

        /* TABLA */
        .table-box { background: var(--card); border-radius: 12px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        table { width: 100%; border-collapse: collapse; text-align: left; }
        th { background: #f8fafc; padding: 18px 25px; font-size: 11px; text-transform: uppercase; color: #64748b; font-weight: 700; border-bottom: 1px solid #e2e8f0; }
        td { padding: 18px 25px; border-bottom: 1px solid #f1f5f9; color: #334155; }
        tr:last-child td { border-bottom: none; }
        tr:hover { background-color: #f8fafc; }
        .badge { background: #dbeafe; color: #1e40af; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: bold; }
        .id-cell { font-family: monospace; font-weight: bold; color: #64748b; background: #f1f5f9; padding: 4px 8px; border-radius: 4px; font-size: 13px; border: 1px solid #e2e8f0; }
        
        /* BOTONES DE ACCI√ìN (NUEVOS) */
        .btn-group-action { display: flex; gap: 8px; justify-content: center; }
        
        .btn-icon { border: 1px solid #e2e8f0; background: white; padding: 6px 10px; border-radius: 6px; cursor: pointer; transition: 0.2s; font-size: 14px; }
        
        .btn-edit { color: var(--primary); border-color: #bfdbfe; }
        .btn-edit:hover { background: var(--primary); color: white; }

        .btn-delete { color: var(--danger); border-color: #fecaca; }
        .btn-delete:hover { background: var(--danger); color: white; }

        /* MODAL */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(4px); z-index: 100; justify-content: center; align-items: center; }
        .modal-content { background: white; width: 90%; max-width: 600px; padding: 30px; border-radius: 16px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); animation: slideIn 0.3s ease; max-height: 90vh; overflow-y: auto; }
        
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .form-full { grid-column: span 2; }

        .form-label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px; color: #475569; }
        .form-input { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px; margin-bottom: 5px; font-size: 15px; outline: none; transition: border 0.2s; box-sizing: border-box; }
        .form-input:focus { border-color: var(--primary); }
        .hint { font-size: 12px; color: #94a3b8; margin-bottom: 10px; display: block; }

        .checkbox-wrapper { display: flex; align-items: center; gap: 10px; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; }
        .checkbox-wrapper:hover { background: #f8fafc; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 20px; grid-column: span 2; }
        .btn-save { flex: 2; background: var(--secondary); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-cancel { flex: 1; background: transparent; color: #64748b; border: 2px solid #e2e8f0; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-save:hover { background: #0f172a; }

        /* PREVIEW TOTAL */
        .total-preview { grid-column: span 2; background: #eff6ff; padding: 15px; text-align: center; border-radius: 8px; color: var(--primary); font-weight: 800; font-size: 18px; border: 1px solid #bfdbfe; margin-top: 10px; }

        @media print {
            .actions, .btn-group-action, th:last-child, td:last-child { display: none !important; }
            body { background: white; padding: 0; }
            .container { max-width: 100%; }
            .card, .chart-box, .table-box { box-shadow: none; border: 1px solid #ccc; }
        }

    </style>
</head>
<body>

    <div class="container">
        
        <div class="header">
            <div>
                <h1>Dep. Investigaci√≥n Aplicada a la Innovaci√≥n</h1>
                <p>Panel de Control Oficial</p>
            </div>
            <div class="actions">
                <button class="btn-print" onclick="window.print()">
                    üñ®Ô∏è Imprimir
                </button>
                <button class="btn-main" onclick="abrirModal()">
                    <span>+</span> Nuevo Gestor
                </button>
            </div>
        </div>

        <div class="kpi-grid">
            <div class="card">
                <div class="kpi-title">Total Gestores</div>
                <div class="kpi-number" id="kpi-total">0</div>
            </div>
            <div class="card">
                <div class="kpi-title">Puntos Totales (PI)</div>
                <div class="kpi-number" id="kpi-puntos" style="color: var(--primary);">0</div>
            </div>
            <div class="card">
                <div class="kpi-title">Top Innovador</div>
                <div class="kpi-number" id="kpi-lider" style="font-size: 24px; color: var(--accent);">---</div>
            </div>
        </div>

        <div class="charts-section">
            <div class="chart-box">
                <div class="chart-header">üèÜ Ranking Global (Puntos PI)</div>
                <div id="chart-points"></div>
            </div>
            <div class="chart-box">
                <div class="chart-header">üí° Ideas Propias Implementadas</div>
                <div id="chart-ideas"></div>
            </div>
        </div>

        <div class="table-box">
            <div class="chart-header" style="margin: 0; padding: 20px 25px; border-bottom: 1px solid #e2e8f0;">
                Directorio y Desglose de Actividades
            </div>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Depto</th>
                        <th title="Complet√≥ Formaci√≥n">Form.</th>
                        <th title="Talleres Asistidos">Talleres</th>
                        <th title="Ideas Propias">Ideas</th>
                        <th title="Actividad Anual">Evento</th>
                        <th>Total PI</th>
                        <th style="text-align: center;">Acciones</th>
                    </tr>
                </thead>
                <tbody id="table-body"></tbody>
            </table>
        </div>

    </div>

    <div class="modal-overlay" id="modal">
        <div class="modal-content">
            <h2 id="modal-title" style="margin-top: 0; margin-bottom: 20px; color: var(--secondary);">Registro y C√°lculo de Puntos</h2>
            <form id="form-gestor" onsubmit="guardarDatoLocal(event)" oninput="calcularTotalEnVivo()">
                
                <div class="form-grid">
                    <div>
                        <label class="form-label">ID Empleado (4 d√≠gitos)</label>
                        <input type="text" id="input-id" class="form-input" placeholder="Ej: 1045" maxlength="4" pattern="\d{4}" title="Debe ser 4 d√≠gitos" required>
                    </div>
                    <div>
                        <label class="form-label">Departamento</label>
                        <select id="input-depto" class="form-input">
                            <option value="Tecnolog√≠a">Tecnolog√≠a</option>
                            <option value="Recursos Humanos">Recursos Humanos</option>
                            <option value="Ventas">Ventas</option>
                            <option value="Operaciones">Operaciones</option>
                            <option value="Finanzas">Finanzas</option>
                            <option value="Investigaci√≥n">Investigaci√≥n</option>
                        </select>
                    </div>
                    <div class="form-full">
                        <label class="form-label">Nombre del Colaborador</label>
                        <input type="text" id="input-nombre" class="form-input" placeholder="Nombre completo" required>
                    </div>

                    <div class="form-full" style="border-top: 1px solid #e2e8f0; margin-top: 10px; padding-top: 10px;">
                        <label class="form-label" style="color: var(--primary);">ASIGNACI√ìN DE PUNTOS (Normativa)</label>
                    </div>

                    <div class="form-full">
                        <label class="checkbox-wrapper">
                            <input type="checkbox" id="check-formacion">
                            <span>Complet√≥ Programa de Formaci√≥n Gestor (+400 PI)</span>
                        </label>
                    </div>

                    <div>
                        <label class="form-label">Talleres Asistidos</label>
                        <input type="number" id="input-talleres" class="form-input" placeholder="0" min="0" max="3">
                        <span class="hint">* 200 PI c/u (M√°x 3)</span>
                    </div>

                    <div>
                        <label class="form-label">Acompa√±amiento Ideadores</label>
                        <input type="number" id="input-mentoria" class="form-input" placeholder="0" min="0" max="5">
                        <span class="hint">* 150 PI c/u (M√°x 5)</span>
                    </div>

                    <div>
                        <label class="form-label">Ideas Propias Implementadas</label>
                        <input type="number" id="input-ideas" class="form-input" placeholder="0" min="0">
                        <span class="hint">* 400 PI por idea</span>
                    </div>

                    <div>
                        <label class="form-label">Puntos por Reconocimiento</label>
                        <input type="number" id="input-premio" class="form-input" placeholder="0" min="0">
                        <span class="hint">* 1000 - 3000 PI</span>
                    </div>

                     <div class="form-full">
                        <label class="checkbox-wrapper">
                            <input type="checkbox" id="check-evento">
                            <span>Particip√≥ en Actividad Anual (+500 PI)</span>
                        </label>
                    </div>

                    <div class="total-preview">
                        Total Calculado: <span id="preview-total">0</span> PI
                    </div>

                    <div class="btn-group">
                        <button type="button" class="btn-cancel" onclick="cerrarModal()">Cancelar</button>
                        <button type="submit" class="btn-save" id="btn-save-text">Guardar Registro</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- BASE DE DATOS (Con tu informaci√≥n intacta) ---
        let datos = [
            { id: "1045", name: "Jorge Tonos", depto: "Tecnolog√≠a", formacion: true, talleres: 3, mentoria: 2, ideas: 2, evento: true, premio: 0, points: 0 },
            { id: "2033", name: "Iris Cesa", depto: "Recursos Humanos", formacion: true, talleres: 2, mentoria: 1, ideas: 1, evento: false, premio: 0, points: 0 },
            { id: "3012", name: "Rosanny Contreras", depto: "Operaciones", formacion: true, talleres: 3, mentoria: 4, ideas: 0, evento: true, premio: 0, points: 0 },
            { id: "4056", name: "Cesar Diaz", depto: "Ventas", formacion: false, talleres: 2, mentoria: 0, ideas: 1, evento: false, premio: 0, points: 0 },
            { id: "5088", name: "Ramon Sanchez", depto: "Finanzas", formacion: true, talleres: 1, mentoria: 0, ideas: 0, evento: false, premio: 0, points: 0 }
        ];

        // VARIABLE PARA CONTROLAR SI EDITAMOS
        let indiceEdicion = -1; // -1 significa que estamos creando uno nuevo

        // --- L√ìGICA DE C√ÅLCULO SEG√öN NORMATIVA (INTACTA) ---
        function calcularPuntos(d) {
            let total = 0;
            if (d.formacion) total += 400;          
            total += (d.talleres || 0) * 200;       
            total += (d.mentoria || 0) * 150;       
            total += (d.ideas || 0) * 400;          
            if (d.evento) total += 500;             
            total += (d.premio || 0);               
            return total;
        }

        function renderizar() {
            // Calcular y Ordenar
            datos.forEach(d => d.points = calcularPuntos(d));
            datos.sort((a, b) => b.points - a.points);

            // KPIs
            document.getElementById('kpi-total').textContent = datos.length;
            const totalGlobal = datos.reduce((sum, item) => sum + item.points, 0);
            document.getElementById('kpi-puntos').textContent = totalGlobal.toLocaleString();
            document.getElementById('kpi-lider').textContent = datos.length > 0 ? datos[0].name : "---";

            // Gr√°ficas
            const chartPoints = document.getElementById('chart-points');
            chartPoints.innerHTML = "";
            const maxPoints = Math.max(...datos.map(d => d.points)) || 100;
            
            datos.slice(0, 10).forEach(d => {
                const percent = (d.points / maxPoints) * 100;
                chartPoints.innerHTML += `
                    <div class="bar-container">
                        <div class="bar-name">${d.name}</div>
                        <div class="bar-bg">
                            <div class="bar-fill" style="width: ${percent}%; background-color: var(--primary);">
                                ${d.points}
                            </div>
                        </div>
                    </div>
                `;
            });

            const chartIdeas = document.getElementById('chart-ideas');
            chartIdeas.innerHTML = "";
            const maxIdeas = Math.max(...datos.map(d => d.ideas)) || 5;

            datos.slice(0, 10).forEach(d => {
                const percent = (d.ideas / maxIdeas) * 100;
                if(d.ideas >= 0) {
                    chartIdeas.innerHTML += `
                        <div class="bar-container">
                            <div class="bar-name">${d.name}</div>
                            <div class="bar-bg">
                                <div class="bar-fill" style="width: ${percent}%; background-color: var(--accent);">
                                    ${d.ideas}
                                </div>
                            </div>
                        </div>
                    `;
                }
            });

            // Tabla con BOTONES NUEVOS
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = "";
            
            datos.forEach((d, index) => {
                tbody.innerHTML += `
                    <tr>
                        <td><span class="id-cell">${d.id}</span></td>
                        <td style="font-weight: 600;">${d.name}</td>
                        <td><span class="badge">${d.depto}</span></td>
                        <td style="text-align: center;">${d.formacion ? '‚úÖ' : '-'}</td>
                        <td style="text-align: center;">${d.talleres}</td>
                        <td style="text-align: center;">${d.ideas}</td>
                        <td style="text-align: center;">${d.evento ? '‚úÖ' : '-'}</td>
                        <td style="color: var(--primary); font-weight: 800;">${d.points}</td>
                        <td style="text-align: center;">
                            <div class="btn-group-action">
                                <button class="btn-icon btn-edit" onclick="cargarEdicion(${index})" title="Modificar Datos">‚úèÔ∏è</button>
                                <button class="btn-icon btn-delete" onclick="eliminarGestor(${index})" title="Eliminar Registro">üóëÔ∏è</button>
                            </div>
                        </td>
                    </tr>
                `;
            });
        }

        // FUNCIONES DE FORMULARIO INTELIGENTE
        
        // 1. Abrir modal para NUEVO
        function abrirModal() { 
            indiceEdicion = -1; // Modo Crear
            document.getElementById('form-gestor').reset();
            document.getElementById('modal-title').textContent = "Registrar Nuevo Gestor";
            document.getElementById('btn-save-text').textContent = "Guardar Registro";
            document.getElementById('input-id').disabled = false; // El ID se puede escribir si es nuevo
            document.getElementById('preview-total').textContent = "0";
            document.getElementById('modal').style.display = 'flex'; 
        }

        // 2. Abrir modal para EDITAR
        function cargarEdicion(index) {
            indiceEdicion = index; // Modo Editar
            const gestor = datos[index];

            // Rellenar formulario con datos existentes
            document.getElementById('input-id').value = gestor.id;
            document.getElementById('input-nombre').value = gestor.name;
            document.getElementById('input-depto').value = gestor.depto;
            
            document.getElementById('check-formacion').checked = gestor.formacion;
            document.getElementById('input-talleres').value = gestor.talleres;
            document.getElementById('input-mentoria').value = gestor.mentoria;
            document.getElementById('input-ideas').value = gestor.ideas;
            document.getElementById('check-evento').checked = gestor.evento;
            document.getElementById('input-premio').value = gestor.premio;

            // Cambiar textos visuales
            document.getElementById('modal-title').textContent = "Modificar Datos del Gestor";
            document.getElementById('btn-save-text').textContent = "Guardar Cambios";
            document.getElementById('input-id').disabled = true; // Bloqueamos el ID para no causar l√≠os
            
            calcularTotalEnVivo(); // Mostrar puntos actuales
            document.getElementById('modal').style.display = 'flex';
        }

        // 3. Guardar (Funciona para ambos casos)
        function guardarDatoLocal(e) {
            e.preventDefault();
            
            const idInput = document.getElementById('input-id').value;

            const gestorFormulario = {
                id: idInput,
                name: document.getElementById('input-nombre').value,
                depto: document.getElementById('input-depto').value,
                formacion: document.getElementById('check-formacion').checked,
                talleres: parseInt(document.getElementById('input-talleres').value) || 0,
                mentoria: parseInt(document.getElementById('input-mentoria').value) || 0,
                ideas: parseInt(document.getElementById('input-ideas').value) || 0,
                evento: document.getElementById('check-evento').checked,
                premio: parseInt(document.getElementById('input-premio').value) || 0,
                points: 0
            };

            if (indiceEdicion === -1) {
                // MODO CREAR: Chequeamos que el ID no exista
                if(datos.find(d => d.id === idInput)) {
                    alert("Error: El ID " + idInput + " ya existe.");
                    return;
                }
                datos.push(gestorFormulario);
            } else {
                // MODO EDITAR: Reemplazamos el viejo por el nuevo
                datos[indiceEdicion] = gestorFormulario;
            }

            renderizar();
            cerrarModal();
        }

        function calcularTotalEnVivo() {
            const temp = {
                formacion: document.getElementById('check-formacion').checked,
                talleres: parseInt(document.getElementById('input-talleres').value) || 0,
                mentoria: parseInt(document.getElementById('input-mentoria').value) || 0,
                ideas: parseInt(document.getElementById('input-ideas').value) || 0,
                evento: document.getElementById('check-evento').checked,
                premio: parseInt(document.getElementById('input-premio').value) || 0
            };
            document.getElementById('preview-total').textContent = calcularPuntos(temp).toLocaleString();
        }

        function eliminarGestor(index) {
            if (confirm("¬øEst√°s seguro de eliminar este registro?")) {
                datos.splice(index, 1);
                renderizar();
            }
        }

        function cerrarModal() { 
            document.getElementById('modal').style.display = 'none'; 
            indiceEdicion = -1; // Resetear siempre
        }

        renderizar();
    </script>
</body>
</html>
