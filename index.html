
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión de Puntos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        body {
            background-color: #f4f6f9;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .card-box {
            transition: transform 0.3s, box-shadow 0.3s;
            border: none;
            border-radius: 15px;
            overflow: hidden;
        }
        .card-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .icon-bg {
            font-size: 3rem;
            opacity: 0.2;
            position: absolute;
            right: 15px;
            bottom: 15px;
        }
        .main-content {
            flex: 1;
        }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
        <div class="container">
            <a class="navbar-brand fw-bold" href="#"><i class="fas fa-star me-2"></i>Gestión de Incentivos</a>
            <div class="d-flex">
                <button class="btn btn-outline-light" data-bs-toggle="modal" data-bs-target="#configModal">
                    <i class="fas fa-cog me-2"></i>Configuración
                </button>
            </div>
        </div>
    </nav>

    <div class="container main-content mt-5">
        <div class="text-center mb-5">
            <h2 class="fw-bold text-dark">Panel de Normativas y Puntos</h2>
            <p class="text-muted">Visualización actual de las reglas del sistema</p>
        </div>

        <div class="row g-4 justify-content-center" id="cardsContainer">
            </div>

        <div class="text-center mt-5 mb-5">
            <button class="btn btn-success btn-lg px-5 py-3 rounded-pill shadow" data-bs-toggle="modal" data-bs-target="#registroGestorModal">
                <i class="fas fa-plus-circle me-2"></i>Registrar Nueva Actividad
            </button>
        </div>
    </div>

    <footer class="footer mt-auto py-3 bg-dark text-white text-center">
        <div class="container">
            <span id="footerText">Sistema de Puntos 2006</span>
        </div>
    </footer>

    <div class="modal fade" id="configModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-light">
                    <h5 class="modal-title"><i class="fas fa-tools me-2"></i>Configurar Normativas</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="alert alert-info py-2"><small>Aquí puedes cambiar los nombres de las actividades y sus valores. Los cambios se reflejarán en todo el sistema.</small></p>
                    <form id="formConfiguracion">
                        <div id="configInputsContainer"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="restablecerFabrica()">Restablecer Valores</button>
                    <button type="button" class="btn btn-primary" onclick="guardarConfiguracion()">Guardar Cambios</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="registroGestorModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title"><i class="fas fa-user-check me-2"></i>Registro de Actividad</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="mb-3">
                            <label class="form-label">Nombre del Colaborador</label>
                            <input type="text" class="form-control" placeholder="Ej: Juan Pérez">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Tipo de Actividad (Normativa)</label>
                            <select class="form-select" id="selectorActividadGestor">
                                </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Fecha</label>
                            <input type="date" class="form-control">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-success" onclick="simularRegistro()">Registrar Puntos</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // --- A. DATOS INICIALES (Valores por defecto) ---
        const valoresPorDefecto = [
            { id: 1, titulo: "Programa de Formación", puntos: 50, color: "primary", icon: "fa-graduation-cap" },
            { id: 2, titulo: "Por Taller Asistido", puntos: 30, color: "info", icon: "fa-chalkboard-teacher" },
            { id: 3, titulo: "Por Acompañamiento", puntos: 20, color: "warning", icon: "fa-hands-helping" },
            { id: 4, titulo: "Por Idea Propia", puntos: 100, color: "danger", icon: "fa-lightbulb" },
            { id: 5, titulo: "Por Evento Anual", puntos: 150, color: "success", icon: "fa-calendar-check" }
        ];

        let normativaActual = [];

        // --- B. INICIALIZACIÓN ---
        document.addEventListener('DOMContentLoaded', () => {
            cargarDatos();
            renderizarTodo();
        });

        // --- C. FUNCIONES DE CARGA Y GUARDADO ---
        function cargarDatos() {
            const datosGuardados = localStorage.getItem('config_sistema_2006');
            if (datosGuardados) {
                normativaActual = JSON.parse(datosGuardados);
            } else {
                normativaActual = JSON.parse(JSON.stringify(valoresPorDefecto)); // Copia profunda
            }
        }

        function guardarConfiguracion() {
            // Leer los valores de los inputs del modal
            const nuevasNormas = [];
            
            // Reconstruir el array basado en los inputs
            normativaActual.forEach((item, index) => {
                const inputTitulo = document.getElementById(`input_titulo_${item.id}`).value;
                const inputPuntos = document.getElementById(`input_puntos_${item.id}`).value;

                nuevasNormas.push({
                    ...item, // mantener color e icono
                    titulo: inputTitulo || item.titulo,
                    puntos: parseInt(inputPuntos) || 0
                });
            });

            normativaActual = nuevasNormas;
            localStorage.setItem('config_sistema_2006', JSON.stringify(normativaActual));
            
            // Cerrar modal
            const modalEl = document.getElementById('configModal');
            const modal = bootstrap.Modal.getInstance(modalEl);
            modal.hide();

            // Actualizar vista
            renderizarTodo();
            alert("¡Configuración actualizada con éxito!");
        }

        function restablecerFabrica() {
            if(confirm("¿Estás seguro de volver a los nombres y puntos originales?")) {
                localStorage.removeItem('config_sistema_2006');
                location.reload();
            }
        }

        // --- D. RENDERIZADO DE INTERFAZ (UI) ---
        function renderizarTodo() {
            const contenedorTarjetas = document.getElementById('cardsContainer');
            const contenedorInputs = document.getElementById('configInputsContainer');
            const selectorGestor = document.getElementById('selectorActividadGestor');

            // Limpiar contenedores
            contenedorTarjetas.innerHTML = '';
            contenedorInputs.innerHTML = '';
            selectorGestor.innerHTML = '<option selected disabled>Seleccione el tipo...</option>';

            // Bucle principal para generar elementos
            normativaActual.forEach(item => {
                
                // 1. Crear Tarjetas (Dashboard)
                const cardHTML = `
                    <div class="col-md-4 col-lg-4">
                        <div class="card card-box bg-${item.color} text-white h-100">
                            <div class="card-body position-relative p-4">
                                <i class="fas ${item.icon} icon-bg"></i>
                                <h5 class="card-title fw-bold mb-3">${item.titulo}</h5>
                                <h2 class="display-4 fw-bold">+${item.puntos}</h2>
                                <p class="mb-0">Puntos otorgados</p>
                            </div>
                        </div>
                    </div>
                `;
                contenedorTarjetas.insertAdjacentHTML('beforeend', cardHTML);

                // 2. Crear Inputs en Modal Configuración
                const inputHTML = `
                    <div class="row mb-3 align-items-center border-bottom pb-2">
                        <div class="col-1 text-center">
                            <i class="fas ${item.icon} text-${item.color} fs-4"></i>
                        </div>
                        <div class="col-7">
                            <label class="small text-muted">Nombre de la Normativa</label>
                            <input type="text" class="form-control fw-bold" id="input_titulo_${item.id}" value="${item.titulo}">
                        </div>
                        <div class="col-4">
                            <label class="small text-muted">Valor (Puntos)</label>
                            <input type="number" class="form-control" id="input_puntos_${item.id}" value="${item.puntos}">
                        </div>
                    </div>
                `;
                contenedorInputs.insertAdjacentHTML('beforeend', inputHTML);

                // 3. Llenar Select del Gestor
                const option = document.createElement('option');
                option.value = item.puntos;
                option.text = `${item.titulo}  —  (Asigna: ${item.puntos} pts)`;
                selectorGestor.appendChild(option);
            });
        }

        // --- E. SIMULACIÓN DE REGISTRO ---
        function simularRegistro() {
            const selector = document.getElementById('selectorActividadGestor');
            if (selector.selectedIndex <= 0) {
                alert("Por favor selecciona una actividad.");
                return;
            }
            // Aquí iría la lógica de guardar en base de datos
            alert("¡Registro Exitoso! Se han asignado los puntos según la normativa actual.");
            
            // Cerrar modal gestor
            const modalEl = document.getElementById('registroGestorModal');
            const modal = bootstrap.Modal.getInstance(modalEl);
            modal.hide();
        }
    </script>
</body>
</html>