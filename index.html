<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión</title>
    
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* Consola de depuración en pantalla (para que veas qué pasa) */
        #debug-console {
            background: #1e1e1e;
            color: #00ff00;
            font-family: monospace;
            padding: 20px;
            margin: 20px;
            border-radius: 8px;
            font-size: 14px;
            border: 2px solid #333;
            max-height: 300px;
            overflow-y: auto;
        }
        .log-line { margin-bottom: 5px; border-bottom: 1px solid #333; padding-bottom: 2px; }
        .error-line { color: #ff4444; font-weight: bold; }
        .success-line { color: #44ff44; }
    </style>

    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>
</head>
<body class="bg-gray-100">

    <div id="debug-console">
        <div class="log-line">1. Iniciando sistema...</div>
    </div>

    <div id="root"></div>

    <script>
        function log(msg, type = 'normal') {
            const consoleDiv = document.getElementById('debug-console');
            const line = document.createElement('div');
            line.className = 'log-line ' + (type === 'error' ? 'error-line' : 'success-line');
            line.textContent = '> ' + msg;
            consoleDiv.appendChild(line);
        }

        window.onerror = function(msg, url, line) {
            log(`ERROR CRÍTICO: ${msg} (Línea: ${line})`, 'error');
            return false;
        };
    </script>

    <script type="text/babel">
        try {
            log("2. React cargado correctamente.");
            
            // Verificamos Recharts
            if (!window.Recharts) {
                throw new Error("La librería de gráficas (Recharts) no cargó.");
            }
            log("3. Gráficas cargadas correctamente.");

            // --- CONFIGURACIÓN ---
            const URL_API = "AQUI_TU_URL_DE_GOOGLE_SCRIPT"; 
            
            const { useState, useEffect } = React;
            // Usamos nombres seguros para las graficas
            const RC = window.Recharts;
            
            // --- COMPONENTE APP ---
            const App = () => {
                const [status, setStatus] = useState("Iniciando...");
                const [gestores, setGestores] = useState([]);

                useEffect(() => {
                    log("4. Componente montado. Intentando conectar a datos...");
                    
                    if (URL_API === "AQUI_TU_URL_DE_GOOGLE_SCRIPT" || URL_API === "") {
                        log("5. Usando datos de prueba (No hay URL).");
                        setGestores([
                            { name: "Ana Demo", depto: "TI", points: 100 },
                            { name: "Juan Demo", depto: "Ventas", points: 80 }
                        ]);
                    } else {
                        log("5. Conectando a Google Sheets...");
                        fetch(URL_API)
                            .then(r => r.json())
                            .then(d => {
                                log("6. ¡Datos recibidos de Google!");
                                setGestores(d);
                            })
                            .catch(e => {
                                log("ERROR DE CONEXIÓN: " + e.message, 'error');
                            });
                    }
                }, []);

                return (
                    <div className="p-8 max-w-4xl mx-auto">
                        <div className="bg-white p-6 rounded-lg shadow-lg">
                            <h1 className="text-2xl font-bold mb-4 text-blue-600">Sistema Funcionando</h1>
                            <p className="mb-4 text-gray-600">Si ves esto, React está vivo.</p>
                            
                            <div className="h-64 border p-4 rounded">
                                <RC.ResponsiveContainer width="100%" height="100%">
                                    <RC.BarChart data={gestores}>
                                        <RC.CartesianGrid strokeDasharray="3 3" />
                                        <RC.XAxis dataKey="name" />
                                        <RC.YAxis />
                                        <RC.Tooltip />
                                        <RC.Bar dataKey="points" fill="#2563eb" />
                                    </RC.BarChart>
                                </RC.ResponsiveContainer>
                            </div>

                            <table className="w-full mt-8 border-collapse">
                                <thead>
                                    <tr className="bg-gray-100">
                                        <th className="p-2 text-left">Nombre</th>
                                        <th className="p-2 text-left">Puntos</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {gestores.map((g, i) => (
                                        <tr key={i} className="border-b">
                                            <td className="p-2">{g.name}</td>
                                            <td className="p-2 font-bold">{g.points}</td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                        </div>
                    </div>
                );
            };

            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<App />);
            log("INTENTO DE RENDERIZADO COMPLETADO");

        } catch (err) {
            log("ERROR EN EL CÓDIGO: " + err.message, 'error');
        }
    </script>
</body>
</html>
