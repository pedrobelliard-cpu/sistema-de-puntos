
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gesti√≥n de puntos</title>
    <style>
        /* --- ESTILOS VISUALES (INTACTOS) --- */
        :root {
            --primary: #2563eb;
            --secondary: #1e293b;     
            --accent: #10b981;        
            --bg: #f1f5f9;            
            --card: #ffffff;          
            --danger: #ef4444;
            --edit: #f59e0b;
        }

        body { font-family: 'Segoe UI', system-ui, sans-serif; background-color: var(--bg); color: var(--secondary);
            margin: 0; padding: 20px; display: flex; flex-direction: column; min-height: 100vh;
        }
        .container { max-width: 1280px; margin: 0 auto; width: 100%; flex: 1;
        }

        /* HEADER */
        .header { display: flex;
            justify-content: space-between; align-items: center; background: var(--card); padding: 20px 30px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); margin-bottom: 30px;
            border-left: 5px solid var(--primary); }
        .header h1 { margin: 0; font-size: 22px;
            color: var(--secondary); text-transform: uppercase; letter-spacing: 0.5px; }
        .header p { margin: 5px 0 0;
            color: var(--primary); font-size: 15px; font-weight: 700; }
        
        .actions { display: flex;
            gap: 10px; }

        .btn-main { background: var(--primary); color: white; border: none;
            padding: 12px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 8px;
        }
        .btn-main:hover { background: #1d4ed8; transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.2); }

        .btn-print { background: var(--secondary);
            color: white; border: none; padding: 12px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;
        }
        .btn-print:hover { background: #334155;
        }

        .btn-config { background: #cbd5e1; color: #334155; border: none; padding: 12px; border-radius: 8px;
            font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px;
        }
        .btn-config:hover { background: #94a3b8; color: white;
        }

        /* KPI CARDS */
        .kpi-grid { display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: var(--card);
            padding: 25px; border-radius: 12px; border: 1px solid #e2e8f0; box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }
        .kpi-title { font-size: 13px; text-transform: uppercase; letter-spacing: 1px; color: #64748b; font-weight: 700;
        }
        .kpi-number { font-size: 36px; font-weight: 800; margin-top: 10px; color: var(--secondary);
        }
        
        /* GR√ÅFICAS */
        .charts-section { display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 25px; margin-bottom: 30px; }
        .chart-box { background: var(--card);
            padding: 25px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .chart-header { font-weight: bold;
            margin-bottom: 20px; font-size: 18px; border-bottom: 2px solid #f1f5f9; padding-bottom: 10px;
        }
        
        .bar-container { display: flex;
            align-items: center; margin-bottom: 15px; font-size: 14px; }
        .bar-name { width: 140px; text-align: right;
            padding-right: 15px; font-weight: 500; color: #475569; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .bar-bg { flex: 1; background: #f1f5f9; height: 28px; border-radius: 6px; overflow: hidden;
            position: relative; }
        .bar-fill { height: 100%; display: flex; align-items: center; justify-content: flex-end;
            padding-right: 10px; color: white; font-weight: bold; font-size: 12px; transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* TABLA Y BUSCADOR */
        .table-box { background: var(--card);
            border-radius: 12px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        
        .table-header-row { display: flex;
            justify-content: space-between; align-items: center; padding: 20px 25px; border-bottom: 1px solid #e2e8f0;
        }
        .table-title { font-weight: bold; font-size: 18px;
        }
        
        .search-container input { padding: 8px 12px;
            border: 1px solid #cbd5e1; border-radius: 6px; font-size: 14px; width: 250px; outline: none; transition: 0.2s;
        }
        .search-container input:focus { border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }

        table { width: 100%;
            border-collapse: collapse; text-align: left; }
        th { background: #f8fafc; padding: 18px 25px;
            font-size: 11px; text-transform: uppercase; color: #64748b; font-weight: 700; border-bottom: 1px solid #e2e8f0;
        }
        td { padding: 18px 25px; border-bottom: 1px solid #f1f5f9; color: #334155;
        }
        tr:last-child td { border-bottom: none;
        }
        tr:hover { background-color: #f8fafc;
        }
        .badge { background: #dbeafe; color: #1e40af; padding: 4px 10px; border-radius: 20px;
            font-size: 11px; font-weight: bold; display: inline-block; max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle;
        }
        .id-cell { font-family: monospace; font-weight: bold; color: #64748b; background: #f1f5f9;
            padding: 4px 8px; border-radius: 4px; font-size: 13px; border: 1px solid #e2e8f0;
        }
        
        /* BOTONES ACCI√ìN */
        .btn-group-action { display: flex;
            gap: 8px; justify-content: center; }
        .btn-icon { border: 1px solid #e2e8f0; background: white;
            padding: 6px 10px; border-radius: 6px; cursor: pointer; transition: 0.2s; font-size: 14px;
        }
        
        .btn-edit { color: var(--primary);
            border-color: #bfdbfe; }
        .btn-edit:hover { background: var(--primary); color: white;
        }

        .btn-delete { color: var(--danger); border-color: #fecaca;
        }
        .btn-delete:hover { background: var(--danger); color: white;
        }

        /* FOOTER */
        .footer { margin-top: 40px;
            text-align: center; color: #94a3b8; font-size: 12px; padding: 20px; border-top: 1px solid #e2e8f0;
        }

        /* MODAL */
        .modal-overlay { display: none;
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(4px); z-index: 100;
            justify-content: center; align-items: center; }
        .modal-content { background: white; width: 90%; max-width: 650px;
            padding: 30px; border-radius: 16px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); animation: slideIn 0.3s ease; max-height: 90vh;
            overflow-y: auto; }
        
        @keyframes slideIn { from { transform: translateY(20px);
            opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .form-grid { display: grid;
            grid-template-columns: 1fr 1fr; gap: 15px; }
        .form-full { grid-column: span 2;
        }

        .form-label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px; color: #475569;
        }
        .form-input { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 8px;
            margin-bottom: 5px; font-size: 14px; outline: none; transition: border 0.2s; box-sizing: border-box;
        }
        .form-input:focus { border-color: var(--primary);
        }
        .hint { font-size: 12px; color: #94a3b8; margin-bottom: 10px; display: block;
        }

        .checkbox-wrapper { display: flex; align-items: center; gap: 10px; padding: 10px;
            border: 1px solid #e2e8f0; border-radius: 8px; cursor: pointer; }
        .checkbox-wrapper:hover { background: #f8fafc;
        }
        
        .btn-group { display: flex;
            gap: 10px; margin-top: 20px; grid-column: span 2; }
        .btn-save { flex: 2;
            background: var(--secondary); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer;
        }
        .btn-cancel { flex: 1; background: transparent; color: #64748b; border: 2px solid #e2e8f0;
            padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-save:hover { background: #0f172a;
        }

        .total-preview { grid-column: span 2; background: #eff6ff; padding: 15px; text-align: center;
            border-radius: 8px; color: var(--primary); font-weight: 800; font-size: 18px; border: 1px solid #bfdbfe; margin-top: 10px;
        }

        #div-otro-depto { animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1;
        } }
        
        /* ESTILO EXTRA PARA CONFIG */
        .config-row { display: flex; gap: 10px; align-items: flex-end; margin-bottom: 15px; }
        .config-col-name { flex: 2; }
        .config-col-points { flex: 1; }

        @media print {
            .actions, .btn-group-action, th:last-child, td:last-child, .search-container { display: none !important;
            }
            body { background: white; padding: 0;
            }
            .container { max-width: 100%;
            }
            .card, .chart-box, .table-box { box-shadow: none;
            border: 1px solid #ccc; }
            .footer { display: none;
            }
        }

    </style>
</head>
<body>

    <div class="container">
        
        <div class="header">
            <div>
                <h1>Dep. Investigaci√≥n Aplicada a la Innovaci√≥n</h1>
                <p>M√≥dulo de Gesti√≥n de Puntos para gestores de innovaci√≥n</p>
            </div>
            <div class="actions">
                <button class="btn-config" onclick="abrirConfig()" title="Configuraci√≥n de Puntos">
                    ‚öôÔ∏è
                </button>
                <button class="btn-print" onclick="window.print()">
                    üñ®Ô∏è Imprimir
                </button>
                <button class="btn-main" onclick="abrirModal()">
                    <span>+</span> Nuevo Gestor
                </button>
            </div>
        </div>

        <div class="kpi-grid">
            <div class="card">
                <div class="kpi-title">Total Gestores</div>
                <div class="kpi-number" id="kpi-total">0</div>
            </div>
            <div class="card">
                <div class="kpi-title">Puntos Totales (PI)</div>
                <div class="kpi-number" id="kpi-puntos" style="color: var(--primary);">0</div>
            </div>
            <div class="card">
                <div class="kpi-title">Top Innovador</div>
                <div class="kpi-number" id="kpi-lider" style="font-size: 24px; color: var(--accent);">---</div>
            </div>
        </div>

        <div class="charts-section">
            <div class="chart-box">
                <div class="chart-header">üèÜ Ranking Global (Puntos PI)</div>
                <div id="chart-points"></div>
            </div>
            <div class="chart-box">
                <div class="chart-header">üí° Ideas Propias Implementadas</div>
                <div id="chart-ideas"></div>
            </div>
        </div>

        <div class="table-box">
            <div class="table-header-row">
                <div class="table-title">Directorio y Desglose</div>
                <div class="search-container">
                    <input type="text" id="input-search" placeholder="üîç Buscar por nombre o ID..." onkeyup="renderizar()">
                </div>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Depto</th>
                        <th id="th-formacion" title="Complet√≥ Formaci√≥n">Form.</th>
                        <th id="th-taller" title="Talleres Asistidos">Tall.</th>
                        <th id="th-ideas" title="Ideas Propias">Ideas</th>
                        <th id="th-evento" title="Actividad Anual">Evento</th>
                        <th>Total PI</th>
                        <th style="text-align: center;">Acciones</th>
                    </tr>
                </thead>
                <tbody id="table-body"></tbody>
            </table>
        </div>

        <div class="footer">
            Sistema de Puntos 2006
        </div>

    </div>

    <div class="modal-overlay" id="modal">
        <div class="modal-content">
            <h2 id="modal-title" style="margin-top: 0; margin-bottom: 20px; color: var(--secondary);">Registro y C√°lculo de Puntos</h2>
            <form id="form-gestor" onsubmit="guardarDatoLocal(event)" oninput="calcularTotalEnVivo()">
                
                <div class="form-grid">
                    <div>
                        <label class="form-label">ID Empleado (4 d√≠gitos)</label>
                        <input type="text" id="input-id" class="form-input" placeholder="Ej: 1045" maxlength="4" pattern="\d{4}" title="Debe ser 4 d√≠gitos" required>
                    </div>
                    <div class="form-full">
                        <label class="form-label">Nombre del Colaborador</label>
                        <input type="text" id="input-nombre" class="form-input" placeholder="Nombre completo" required>
                    </div>

                    <div class="form-full">
                        <label class="form-label">Direcci√≥n / Departamento</label>
                        <select id="input-depto" class="form-input" onchange="verificarOtroDepto()">
                            <option value="">Seleccione una opci√≥n...</option>
                            <optgroup label="DIRECCIONES">
                                <option value="Direcci√≥n Jur√≠dica">Direcci√≥n Jur√≠dica</option>
                                <option value="Direcci√≥n de Planificaci√≥n y Desarrollo">Direcci√≥n de Planificaci√≥n y Desarrollo</option>
                                <option value="Direcci√≥n de Gesti√≥n Humana">Direcci√≥n de Gesti√≥n Humana</option>
                                <option value="Direcci√≥n de Comunicaciones">Direcci√≥n de Comunicaciones</option>
                                <option value="Direcci√≥n de TI y Comunicaciones">Direcci√≥n de TI y Comunicaciones</option>
                                <option value="Direcci√≥n de Administraci√≥n y Finanzas">Direcci√≥n de Administraci√≥n y Finanzas</option>
                                <option value="Direcci√≥n de Formaci√≥n Profesional">Direcci√≥n de Formaci√≥n Profesional</option>
                                <option value="Direcci√≥n de Competitividad Empresarial">Direcci√≥n de Competitividad Empresarial</option>
                                <option value="Direcci√≥n de Rector√≠a y Regulaci√≥n de Centros">Direcci√≥n de Rector√≠a y Regulaci√≥n de Centros</option>
                                <option value="Direcci√≥n de Innovaci√≥n y Desarrollo">Direcci√≥n de Innovaci√≥n y Desarrollo</option>
                                <option value="Direcci√≥n de Monitoreo, Proyectos y Convenios">Direcci√≥n de Monitoreo, Proyectos y Convenios</option>
                                <option value="Direcci√≥n Regional Metropolitana">Direcci√≥n Regional Metropolitana</option>
                                <option value="Direcci√≥n Regional Oriental">Direcci√≥n Regional Oriental</option>
                                <option value="Direcci√≥n Regional Cibao Norte">Direcci√≥n Regional Cibao Norte</option>
                                <option value="Direcci√≥n Regional Cibao Sur">Direcci√≥n Regional Cibao Sur</option>
                                <option value="Direcci√≥n Regional Este">Direcci√≥n Regional Este</option>
                                <option value="Direcci√≥n Regional Sur">Direcci√≥n Regional Sur</option>
                            </optgroup>
                            <optgroup label="DEPARTAMENTOS">
                                <option value="Departamento de Documentos Legales">Departamento de Documentos Legales</option>
                                <option value="Departamento de Planes y Proyectos">Departamento de Planes y Proyectos</option>
                                <option value="Departamento de Organizaci√≥n del Trabajo">Departamento de Organizaci√≥n del Trabajo</option>
                                <option value="Departamento de Mercadeo">Departamento de Mercadeo</option>
                                <option value="Departamento de Administraci√≥n de Servicios TIC">Departamento de Administraci√≥n de Servicios TIC</option>
                                <option value="Departamento de Contabilidad">Departamento de Contabilidad</option>
                                <option value="Departamento de Desarrollo Curricular">Departamento de Desarrollo Curricular</option>
                                <option value="Departamento de Validaci√≥n y Homologaci√≥n">Departamento de Validaci√≥n y Homologaci√≥n</option>
                                <option value="Departamento de Estrategias Empresariales">Departamento de Estrategias Empresariales</option>
                                <option value="Departamento de Concursos">Departamento de Concursos</option>
                                <option value="Departamento de Litigios">Departamento de Litigios</option>
                                <option value="Departamento de Investigaci√≥n">Departamento de Investigaci√≥n</option>
                                <option value="Departamento de Reclutamiento y Selecci√≥n">Departamento de Reclutamiento y Selecci√≥n</option>
                                <option value="Departamento de Prensa y Relaciones P√∫blicas">Departamento de Prensa y Relaciones P√∫blicas</option>
                                <option value="Departamento de Desarrollo e Implementaci√≥n de Sistemas">Departamento de Desarrollo e Implementaci√≥n de Sistemas</option>
                                <option value="Departamento de Tesorer√≠a">Departamento de Tesorer√≠a</option>
                                <option value="Departamento de Evaluaci√≥n y Acreditaci√≥n">Departamento de Evaluaci√≥n y Acreditaci√≥n</option>
                                <option value="Departamento de Admisi√≥n y Empleo">Departamento de Admisi√≥n y Empleo</option>
                                <option value="Departamento de Formaci√≥n y Programas">Departamento de Formaci√≥n y Programas</option>
                                <option value="Departamento de Acreditaci√≥n de Centros">Departamento de Acreditaci√≥n de Centros</option>
                                <option value="Departamento de Desarrollo Institucional">Departamento de Desarrollo Institucional</option>
                                <option value="Departamento de Capacitaci√≥n y ED">Departamento de Capacitaci√≥n y ED</option>
                                <option value="Departamento de Operaciones TIC">Departamento de Operaciones TIC</option>
                                <option value="Departamento de Servicios Generales">Departamento de Servicios Generales</option>
                                <option value="Departamento de Investigaci√≥n y Producci√≥n Did√°ctica">Departamento de Investigaci√≥n y Producci√≥n Did√°ctica</option>
                                <option value="Departamento de Fiscalizaci√≥n de Centros">Departamento de Fiscalizaci√≥n de Centros</option>
                                <option value="Departamento de Compensaci√≥n">Departamento de Compensaci√≥n</option>
                                <option value="Departamento de Seguridad y Monitoreo TIC">Departamento de Seguridad y Monitoreo TIC</option>
                                <option value="Departamento de Compras y Contrataciones">Departamento de Compras y Contrataciones</option>
                                <option value="Departamento de Ingresos">Departamento de Ingresos</option>
                                <option value="Departamento de Seguridad">Departamento de Seguridad</option>
                                <option value="Departamento de Investigaci√≥n Aplicada a la Innovaci√≥n">Departamento de Investigaci√≥n Aplicada a la Innovaci√≥n</option>
                            </optgroup>
                            <option value="OTRO" style="font-weight: bold; color: var(--primary);">OTRO (Especifique Manualmente)</option>
                        </select>

                        <div id="div-otro-depto" style="display: none; margin-top: 10px;">
                            <label class="form-label" style="font-size: 12px; color: var(--primary);">Especifique el nombre del √°rea:</label>
                            <input type="text" id="input-otro-depto" class="form-input" placeholder="Escriba el nombre aqu√≠...">
                        </div>
                    </div>

                    <div class="form-full" style="border-top: 1px solid #e2e8f0; margin-top: 10px; padding-top: 10px;">
                        <label class="form-label" style="color: var(--primary);">ASIGNACI√ìN DE PUNTOS (Normativa Configurable)</label>
                    </div>

                    <div class="form-full">
                        <label class="checkbox-wrapper">
                            <input type="checkbox" id="check-formacion">
                            <span id="hint-formacion">Complet√≥ Programa de Formaci√≥n Gestor (+400 PI)</span>
                        </label>
                    </div>

                    <div>
                        <label class="form-label" id="lbl-taller">Talleres Asistidos</label>
                        <input type="number" id="input-talleres" class="form-input" placeholder="0" min="0" max="3">
                        <span class="hint" id="hint-taller">* 200 PI c/u (M√°x 3)</span>
                    </div>

                    <div>
                        <label class="form-label" id="lbl-mentoria">Acompa√±amiento Ideadores</label>
                        <input type="number" id="input-mentoria" class="form-input" placeholder="0" min="0" max="5">
                        <span class="hint" id="hint-mentoria">* 150 PI c/u (M√°x 5)</span>
                    </div>

                    <div>
                        <label class="form-label" id="lbl-ideas">Ideas Propias Implementadas</label>
                        <input type="number" id="input-ideas" class="form-input" placeholder="0" min="0">
                        <span class="hint" id="hint-ideas">* 400 PI por idea</span>
                    </div>

                    <div>
                        <label class="form-label">Puntos por Reconocimiento</label>
                        <input type="number" id="input-premio" class="form-input" placeholder="0" min="0">
                        <span class="hint">* Manual (1000 - 3000 PI)</span>
                    </div>

                     <div class="form-full">
                        <label class="checkbox-wrapper">
                            <input type="checkbox" id="check-evento">
                            <span id="hint-evento">Particip√≥ en Actividad Anual (+500 PI)</span>
                        </label>
                    </div>

                    <div class="total-preview">
                        Total Calculado: <span id="preview-total">0</span> PI
                    </div>

                    <div class="btn-group">
                        <button type="button" class="btn-cancel" onclick="cerrarModal()">Cancelar</button>
                        <button type="submit" class="btn-save" id="btn-save-text">Guardar Registro</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="modal-config">
        <div class="modal-content" style="max-width: 500px;">
            <h2 style="margin-top: 0; color: var(--secondary);">‚öôÔ∏è Configuraci√≥n de Normativa</h2>
            <p style="font-size: 13px; color: #64748b; margin-bottom: 20px;">Edite el Nombre de la actividad y sus Puntos correspondientes.</p>
            
            <form onsubmit="guardarConfig(event)">
                
                <div class="config-row">
                    <div class="config-col-name">
                        <label class="form-label">Nombre Normativa 1</label>
                        <input type="text" id="conf-name-formacion" class="form-input" required placeholder="Ej: Programa de Formaci√≥n">
                    </div>
                    <div class="config-col-points">
                        <label class="form-label">Puntos</label>
                        <input type="number" id="conf-val-formacion" class="form-input" required>
                    </div>
                </div>

                <div class="config-row">
                    <div class="config-col-name">
                        <label class="form-label">Nombre Normativa 2</label>
                        <input type="text" id="conf-name-taller" class="form-input" required>
                    </div>
                    <div class="config-col-points">
                        <label class="form-label">Puntos</label>
                        <input type="number" id="conf-val-taller" class="form-input" required>
                    </div>
                </div>
                
                <div class="config-row">
                    <div class="config-col-name">
                        <label class="form-label">Nombre Normativa 3</label>
                        <input type="text" id="conf-name-mentoria" class="form-input" required>
                    </div>
                    <div class="config-col-points">
                        <label class="form-label">Puntos</label>
                        <input type="number" id="conf-val-mentoria" class="form-input" required>
                    </div>
                </div>
                
                <div class="config-row">
                    <div class="config-col-name">
                        <label class="form-label">Nombre Normativa 4</label>
                        <input type="text" id="conf-name-ideas" class="form-input" required>
                    </div>
                    <div class="config-col-points">
                        <label class="form-label">Puntos</label>
                        <input type="number" id="conf-val-ideas" class="form-input" required>
                    </div>
                </div>
                
                <div class="config-row">
                    <div class="config-col-name">
                        <label class="form-label">Nombre Normativa 5</label>
                        <input type="text" id="conf-name-evento" class="form-input" required>
                    </div>
                    <div class="config-col-points">
                        <label class="form-label">Puntos</label>
                        <input type="number" id="conf-val-evento" class="form-input" required>
                    </div>
                </div>

                <div class="btn-group">
                    <button type="button" class="btn-cancel" onclick="cerrarConfig()">Cancelar</button>
                    <button type="submit" class="btn-save">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // --- CONFIGURACI√ìN GLOBAL DE NOMBRES Y PUNTOS (MODIFICADO) ---
        // Ahora guardamos objetos con 'nombre' y 'valor'
        let configNormativa = {
            formacion: { nombre: "Programa de Formaci√≥n", valor: 400 },
            taller: { nombre: "Por Taller Asistido", valor: 200 },
            mentoria: { nombre: "Por Acompa√±amiento", valor: 150 },
            ideas: { nombre: "Por Idea Propia", valor: 400 },
            evento: { nombre: "Por Evento Anual", valor: 500 }
        };

        // --- DATOS INICIALES ---
        let datos = [
            { id: "1045", name: "Jorge Tonos", depto: "Direcci√≥n de TI y Comunicaciones", formacion: true, talleres: 3, mentoria: 2, ideas: 2, evento: true, premio: 0, points: 0 },
            { id: "2033", name: "Iris Cesa", depto: "Direcci√≥n de Gesti√≥n Humana", formacion: true, talleres: 2, mentoria: 1, ideas: 1, evento: false, premio: 0, points: 0 },
            { id: "3012", name: "Rosanny Contreras", depto: "Departamento de Operaciones TIC", formacion: true, talleres: 3, mentoria: 4, ideas: 0, evento: true, premio: 0, points: 0 },
            { id: "4056", name: "Cesar Diaz", depto: "Departamento de Mercadeo", formacion: false, talleres: 2, mentoria: 0, ideas: 1, evento: false, premio: 0, points: 0 },
            { id: "5088", name: "Ramon Sanchez", depto: "Direcci√≥n de Administraci√≥n y Finanzas", formacion: true, talleres: 1, mentoria: 0, ideas: 0, evento: false, premio: 0, points: 0 }
        ];

        let indiceEdicion = -1;

        // --- C√ÅLCULO DIN√ÅMICO (MODIFICADO para usar nueva estructura) ---
        function calcularPuntos(d) {
            let total = 0;
            if (d.formacion) total += configNormativa.formacion.valor;          
            total += (d.talleres || 0) * configNormativa.taller.valor;       
            total += (d.mentoria || 0) * configNormativa.mentoria.valor;
            total += (d.ideas || 0) * configNormativa.ideas.valor;          
            if (d.evento) total += configNormativa.evento.valor;             
            total += (d.premio || 0);               
            return total;
        }

        function renderizar() {
            // Actualizar etiquetas visuales de la interfaz
            actualizarTextosInterfaz();

            // Filtrado por buscador
            const termino = document.getElementById('input-search') ? document.getElementById('input-search').value.toLowerCase() : "";
            
            // Recalcular puntos con la configuraci√≥n actual
            datos.forEach(d => d.points = calcularPuntos(d));
            datos.sort((a, b) => b.points - a.points);

            const datosFiltrados = datos.filter(d => 
                d.name.toLowerCase().includes(termino) || 
                d.id.includes(termino) ||
                d.depto.toLowerCase().includes(termino)
            );

            document.getElementById('kpi-total').textContent = datos.length;
            const totalGlobal = datos.reduce((sum, item) => sum + item.points, 0);
            document.getElementById('kpi-puntos').textContent = totalGlobal.toLocaleString();
            document.getElementById('kpi-lider').textContent = datos.length > 0 ? datos[0].name : "---";

            // Gr√°ficas
            const chartPoints = document.getElementById('chart-points');
            chartPoints.innerHTML = "";
            const maxPoints = Math.max(...datos.map(d => d.points)) || 100;
            datos.slice(0, 10).forEach(d => {
                const percent = (d.points / maxPoints) * 100;
                chartPoints.innerHTML += `
                    <div class="bar-container">
                        <div class="bar-name">${d.name}</div>
                        <div class="bar-bg">
                            <div class="bar-fill" style="width: ${percent}%; background-color: var(--primary);">
                                ${d.points}
                            </div>
                        </div>
                    </div>
                `;
            });

            const chartIdeas = document.getElementById('chart-ideas');
            chartIdeas.innerHTML = "";
            const maxIdeas = Math.max(...datos.map(d => d.ideas)) || 5;
            datos.slice(0, 10).forEach(d => {
                const percent = (d.ideas / maxIdeas) * 100;
                if(d.ideas >= 0) {
                    chartIdeas.innerHTML += `
                        <div class="bar-container">
                            <div class="bar-name">${d.name}</div>
                            <div class="bar-bg">
                                <div class="bar-fill" style="width: ${percent}%; background-color: var(--accent);">
                                    ${d.ideas}
                                </div>
                            </div>
                        </div>
                    `;
                }
            });

            // Tabla
            const tbody = document.getElementById('table-body');
            tbody.innerHTML = "";
            if (datosFiltrados.length === 0) {
                tbody.innerHTML = `<tr><td colspan="9" style="text-align:center; padding: 20px; color: #94a3b8;">No se encontraron resultados para "${termino}"</td></tr>`;
            } else {
                datosFiltrados.forEach((d) => {
                    const indexOriginal = datos.findIndex(item => item.id === d.id);
                    
                    tbody.innerHTML += `
                        <tr>
                            <td><span class="id-cell">${d.id}</span></td>
                            <td style="font-weight: 600;">${d.name}</td>
                            <td><span class="badge" title="${d.depto}">${d.depto}</span></td>
                            <td style="text-align: center;">${d.formacion ? '‚úÖ' : '-'}</td>
                            <td style="text-align: center;">${d.talleres}</td>
                            <td style="text-align: center;">${d.ideas}</td>
                            <td style="text-align: center;">${d.evento ? '‚úÖ' : '-'}</td>
                            <td style="color: var(--primary); font-weight: 800;">${d.points}</td>
                            <td style="text-align: center;">
                                <div class="btn-group-action">
                                    <button class="btn-icon btn-edit" onclick="cargarEdicion(${indexOriginal})" title="Modificar">‚úèÔ∏è</button>
                                    <button class="btn-icon btn-delete" onclick="eliminarGestor(${indexOriginal})" title="Eliminar">üóëÔ∏è</button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
            }
        }

        // --- GESTI√ìN DE CONFIGURACI√ìN (ACTUALIZADO) ---
        function abrirConfig() {
            // Cargar NOMBRES
            document.getElementById('conf-name-formacion').value = configNormativa.formacion.nombre;
            document.getElementById('conf-name-taller').value = configNormativa.taller.nombre;
            document.getElementById('conf-name-mentoria').value = configNormativa.mentoria.nombre;
            document.getElementById('conf-name-ideas').value = configNormativa.ideas.nombre;
            document.getElementById('conf-name-evento').value = configNormativa.evento.nombre;

            // Cargar VALORES (PUNTOS)
            document.getElementById('conf-val-formacion').value = configNormativa.formacion.valor;
            document.getElementById('conf-val-taller').value = configNormativa.taller.valor;
            document.getElementById('conf-val-mentoria').value = configNormativa.mentoria.valor;
            document.getElementById('conf-val-ideas').value = configNormativa.ideas.valor;
            document.getElementById('conf-val-evento').value = configNormativa.evento.valor;
            
            document.getElementById('modal-config').style.display = 'flex';
        }

        function cerrarConfig() {
            document.getElementById('modal-config').style.display = 'none';
        }

        function guardarConfig(e) {
            e.preventDefault();
            
            // Guardar NOMBRES y PUNTOS
            configNormativa.formacion.nombre = document.getElementById('conf-name-formacion').value;
            configNormativa.formacion.valor = parseInt(document.getElementById('conf-val-formacion').value) || 0;

            configNormativa.taller.nombre = document.getElementById('conf-name-taller').value;
            configNormativa.taller.valor = parseInt(document.getElementById('conf-val-taller').value) || 0;

            configNormativa.mentoria.nombre = document.getElementById('conf-name-mentoria').value;
            configNormativa.mentoria.valor = parseInt(document.getElementById('conf-val-mentoria').value) || 0;

            configNormativa.ideas.nombre = document.getElementById('conf-name-ideas').value;
            configNormativa.ideas.valor = parseInt(document.getElementById('conf-val-ideas').value) || 0;

            configNormativa.evento.nombre = document.getElementById('conf-name-evento').value;
            configNormativa.evento.valor = parseInt(document.getElementById('conf-val-evento').value) || 0;
            
            actualizarTextosInterfaz(); // Refrescar los textos en formularios y tablas
            renderizar(); // Recalcular todo
            cerrarConfig();
        }

        // --- FUNCI√ìN NUEVA: ACTUALIZA TEXTOS EN PANTALLA SEG√öN CONFIG ---
        function actualizarTextosInterfaz() {
            // 1. En el formulario de registro (Labels principales)
            document.getElementById('lbl-taller').textContent = configNormativa.taller.nombre;
            document.getElementById('lbl-mentoria').textContent = configNormativa.mentoria.nombre;
            document.getElementById('lbl-ideas').textContent = configNormativa.ideas.nombre;

            // 2. En el formulario de registro (Hints/Subtextos con puntos)
            document.getElementById('hint-formacion').textContent = `${configNormativa.formacion.nombre} (+${configNormativa.formacion.valor} PI)`;
            document.getElementById('hint-taller').textContent = `* ${configNormativa.taller.valor} PI c/u (M√°x 3)`;
            document.getElementById('hint-mentoria').textContent = `* ${configNormativa.mentoria.valor} PI c/u (M√°x 5)`;
            document.getElementById('hint-ideas').textContent = `* ${configNormativa.ideas.valor} PI por idea`;
            document.getElementById('hint-evento').textContent = `${configNormativa.evento.nombre} (+${configNormativa.evento.valor} PI)`;

            // 3. En la tabla principal (Encabezados de columna)
            // Abreviamos un poco si es muy largo para que no rompa la tabla, o usamos el nombre completo en 'title'
            document.getElementById('th-formacion').title = configNormativa.formacion.nombre;
            document.getElementById('th-taller').title = configNormativa.taller.nombre;
            document.getElementById('th-ideas').title = configNormativa.ideas.nombre;
            document.getElementById('th-evento').title = configNormativa.evento.nombre;
        }

        // --- L√ìGICA DEPARTAMENTOS ---
        function verificarOtroDepto() {
            const select = document.getElementById('input-depto');
            const divOtro = document.getElementById('div-otro-depto');
            const inputOtro = document.getElementById('input-otro-depto');

            if (select.value === 'OTRO') {
                divOtro.style.display = 'block';
                inputOtro.setAttribute('required', 'true');
            } else {
                divOtro.style.display = 'none';
                inputOtro.removeAttribute('required');
                inputOtro.value = ''; 
            }
        }

        // --- FORMULARIO ---
        function abrirModal() { 
            indiceEdicion = -1;
            document.getElementById('form-gestor').reset();
            verificarOtroDepto(); 
            actualizarTextosInterfaz(); // Asegurar que los textos est√°n al d√≠a
            document.getElementById('modal-title').textContent = "Registrar Nuevo Gestor";
            document.getElementById('btn-save-text').textContent = "Guardar Registro";
            document.getElementById('input-id').disabled = false; 
            document.getElementById('preview-total').textContent = "0";
            document.getElementById('modal').style.display = 'flex';
        }

        function cargarEdicion(index) {
            indiceEdicion = index;
            const gestor = datos[index];

            document.getElementById('input-id').value = gestor.id;
            document.getElementById('input-nombre').value = gestor.name;
            
            const select = document.getElementById('input-depto');
            const opciones = Array.from(select.options).map(o => o.value);
            if (opciones.includes(gestor.depto)) {
                select.value = gestor.depto;
            } else {
                select.value = 'OTRO';
                document.getElementById('input-otro-depto').value = gestor.depto;
            }
            verificarOtroDepto(); 

            document.getElementById('check-formacion').checked = gestor.formacion;
            document.getElementById('input-talleres').value = gestor.talleres;
            document.getElementById('input-mentoria').value = gestor.mentoria;
            document.getElementById('input-ideas').value = gestor.ideas;
            document.getElementById('check-evento').checked = gestor.evento;
            document.getElementById('input-premio').value = gestor.premio;

            actualizarTextosInterfaz();
            document.getElementById('modal-title').textContent = "Modificar Datos";
            document.getElementById('btn-save-text').textContent = "Guardar Cambios";
            document.getElementById('input-id').disabled = true; 
            
            calcularTotalEnVivo();
            document.getElementById('modal').style.display = 'flex';
        }

        function guardarDatoLocal(e) {
            e.preventDefault();
            const idInput = document.getElementById('input-id').value;
            
            const select = document.getElementById('input-depto');
            let departamentoFinal = select.value;
            if (departamentoFinal === 'OTRO') {
                departamentoFinal = document.getElementById('input-otro-depto').value.trim();
                if (!departamentoFinal) {
                    alert("Por favor especifique el nombre del departamento.");
                    return;
                }
            }

            const gestorFormulario = {
                id: idInput,
                name: document.getElementById('input-nombre').value,
                depto: departamentoFinal, 
                formacion: document.getElementById('check-formacion').checked,
                talleres: parseInt(document.getElementById('input-talleres').value) || 0,
                mentoria: parseInt(document.getElementById('input-mentoria').value) || 0,
                ideas: parseInt(document.getElementById('input-ideas').value) || 0,
                evento: document.getElementById('check-evento').checked,
                premio: parseInt(document.getElementById('input-premio').value) || 0,
                points: 0
            };

            if (indiceEdicion === -1) {
                if(datos.find(d => d.id === idInput)) {
                    alert("Error: El ID " + idInput + " ya existe.");
                    return;
                }
                datos.push(gestorFormulario);
            } else {
                datos[indiceEdicion] = gestorFormulario;
            }

            renderizar();
            cerrarModal();
        }

        function calcularTotalEnVivo() {
            const temp = {
                formacion: document.getElementById('check-formacion').checked,
                talleres: parseInt(document.getElementById('input-talleres').value) || 0,
                mentoria: parseInt(document.getElementById('input-mentoria').value) || 0,
                ideas: parseInt(document.getElementById('input-ideas').value) || 0,
                evento: document.getElementById('check-evento').checked,
                premio: parseInt(document.getElementById('input-premio').value) || 0
            };
            document.getElementById('preview-total').textContent = calcularPuntos(temp).toLocaleString();
        }

        function eliminarGestor(index) {
            if (confirm("¬øEst√°s seguro de eliminar este registro?")) {
                datos.splice(index, 1);
                renderizar();
            }
        }

        function cerrarModal() { 
            document.getElementById('modal').style.display = 'none';
            indiceEdicion = -1;
        }

        // Inicializar textos de ayuda
        actualizarTextosInterfaz();
        renderizar();
    </script>
</body>
</html>